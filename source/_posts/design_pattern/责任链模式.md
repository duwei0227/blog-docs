---
title: è®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼
published: false
layout: post
date: 2025-12-11 19:40:00
permalink: /design_pattern/chain_pattern.html
categories: [è®¾è®¡æ¨¡å¼]

---



## æ¦‚å¿µ

**è´£ä»»é“¾æ¨¡å¼**æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä½ å°†è¯·æ±‚æ²¿ç€å¤„ç†è€…é“¾è¿›è¡Œå‘é€ã€‚æ”¶åˆ°è¯·æ±‚åï¼Œæ¯ä¸ªå¤„ç†è€…å‡å¯å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæˆ–å°†å…¶ä¼ é€’ç»™é“¾ä¸Šçš„ä¸‹ä¸€ä¸ªå¤„ç†è€…ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼š**å°†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦**ï¼Œè®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œå°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚

**å…³é”®ç‰¹ç‚¹**ï¼š

- **è§£è€¦å‘é€è€…å’Œæ¥æ”¶è€…**ï¼šå‘é€è€…ä¸éœ€è¦çŸ¥é“å“ªä¸ªæ¥æ”¶è€…ä¼šå¤„ç†è¯·æ±‚
- **åŠ¨æ€ç»„åˆå¤„ç†é“¾**ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ”¹å˜å¤„ç†é“¾
- **çµæ´»å¤„ç†è¯·æ±‚**ï¼šæ¯ä¸ªå¤„ç†å™¨å¯ä»¥å†³å®šæ˜¯å¦å¤„ç†è¯·æ±‚æˆ–ä¼ é€’ç»™ä¸‹ä¸€ä¸ª



## é€‚ç”¨åœºæ™¯

**âœ… é€‚ç”¨åœºæ™¯ï¼š**

1. **å¤šçº§å®¡æ‰¹æµç¨‹**ï¼šå¦‚è¯·å‡å®¡æ‰¹ã€è´¹ç”¨æŠ¥é”€ç­‰
2. **è¯·æ±‚è¿‡æ»¤é“¾**ï¼šå¦‚Webè¯·æ±‚è¿‡æ»¤å™¨ã€æ—¥å¿—è¿‡æ»¤å™¨
3. **äº‹ä»¶å¤„ç†ç³»ç»Ÿ**ï¼šå¦‚GUIäº‹ä»¶å¤„ç†ã€å¼‚å¸¸å¤„ç†
4. **æ¸¸æˆå¼€å‘**ï¼šå¦‚ä¼¤å®³è®¡ç®—é“¾ã€æŠ€èƒ½æ•ˆæœé“¾
5. **æƒé™æ ¡éªŒ**ï¼šå¦‚å¤šçº§æƒé™éªŒè¯



**âŒ ä¸é€‚ç”¨åœºæ™¯ï¼š**

- è¯·æ±‚åªèƒ½è¢«ä¸€ä¸ªå¤„ç†è€…å¤„ç†
- å¤„ç†é“¾æ˜¯å›ºå®šçš„ï¼Œä¸éœ€è¦åŠ¨æ€å˜åŒ–
- å¤„ç†é€»è¾‘ç®€å•ï¼Œä¸éœ€è¦é“¾å¼ç»“æ„



**ğŸ¯ å…¸å‹ä¾‹å­ï¼š**

- **è¯·å‡å®¡æ‰¹ç³»ç»Ÿ**ï¼šå‘˜å·¥â†’ç»„é•¿â†’ç»ç†â†’æ€»ç›‘â†’CEO
- **Webè¿‡æ»¤å™¨é“¾**ï¼šè®¤è¯â†’æˆæƒâ†’æ—¥å¿—â†’ç¼“å­˜
- **å¼‚å¸¸å¤„ç†**ï¼šå…·ä½“å¼‚å¸¸â†’çˆ¶ç±»å¼‚å¸¸â†’å…¨å±€å¼‚å¸¸
- **æ—¥å¿—ç³»ç»Ÿ**ï¼šDEBUGâ†’INFOâ†’WARNâ†’ERROR
- **æ¸¸æˆæ”»å‡»è®¡ç®—**ï¼šåŸºç¡€æ”»å‡»â†’æš´å‡»â†’ç©¿é€â†’å¸è¡€



## ç±»å›¾

![image-20251211194707134](https://raw.githubusercontent.com/duwei0227/picbed/main/blogs/image-20251211194707134.png)

**ç±»å›¾è¯´æ˜ï¼š**

- **`Client`ï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼šå‘é“¾ä¸Šçš„ç¬¬ä¸€ä¸ªå¤„ç†è€…å‘é€è¯·æ±‚
- **`Handler`ï¼ˆæŠ½è±¡å¤„ç†è€…ï¼‰**ï¼šå®šä¹‰å¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒæŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è€…çš„å¼•ç”¨
- **`ConcreteHandler`ï¼ˆå…·ä½“å¤„ç†è€…ï¼‰**ï¼šå®ç°å…·ä½“çš„å¤„ç†é€»è¾‘ï¼Œå†³å®šæ˜¯å¦å¤„ç†è¯·æ±‚æˆ–ä¼ é€’ç»™ä¸‹ä¸€ä¸ª



## ç¤ºä¾‹(è¯·å‡å®¡æ‰¹ç³»ç»Ÿ)

### 1. è¯·æ±‚ç±»

```java
package cn.probiecoder.chain;

import java.time.LocalDate;

// è¯·å‡è¯·æ±‚
public class LeaveRequest {
    private String employeeName;
    private int leaveDays;
    private String reason;
    private LocalDate startDate;
    
    public LeaveRequest(String employeeName, int leaveDays, String reason, LocalDate startDate) {
        this.employeeName = employeeName;
        this.leaveDays = leaveDays;
        this.reason = reason;
        this.startDate = startDate;
    }
    
    // Getters
    public String getEmployeeName() { return employeeName; }
    public int getLeaveDays() { return leaveDays; }
    public String getReason() { return reason; }
    public LocalDate getStartDate() { return startDate; }
    
    @Override
    public String toString() {
        return "è¯·å‡ç”³è¯·{" +
                "å‘˜å·¥='" + employeeName + '\'' +
                ", å¤©æ•°=" + leaveDays +
                ", äº‹ç”±='" + reason + '\'' +
                ", å¼€å§‹æ—¥æœŸ=" + startDate +
                '}';
    }
}
```





### 2. å®¡æ‰¹ç»“æœç±»

```java
package cn.probiecoder.chain;

import java.time.LocalDateTime;

// å®¡æ‰¹ç»“æœ
public class ApprovalResult {
    private boolean approved;
    private String approver;
    private String comments;
    private LocalDateTime approvalTime;
    
    public ApprovalResult(boolean approved, String approver, String comments) {
        this.approved = approved;
        this.approver = approver;
        this.comments = comments;
        this.approvalTime = LocalDateTime.now();
    }
    
    // Getters
    public boolean isApproved() { return approved; }
    public String getApprover() { return approver; }
    public String getComments() { return comments; }
    public LocalDateTime getApprovalTime() { return approvalTime; }
    
    @Override
    public String toString() {
        return "å®¡æ‰¹ç»“æœ{" +
                "æ‰¹å‡†=" + approved +
                ", å®¡æ‰¹äºº='" + approver + '\'' +
                ", æ„è§='" + comments + '\'' +
                ", å®¡æ‰¹æ—¶é—´=" + approvalTime +
                '}';
    }
}
```



### 3. æŠ½è±¡å¤„ç†è€…

```java
package cn.probiecoder.chain;

// å®¡æ‰¹è€…æŠ½è±¡ç±»
public abstract class Approver {
    protected Approver nextApprover;
    protected String name;
    protected int maxApprovalDays; // æœ€å¤§å®¡æ‰¹å¤©æ•°
    
    public Approver(String name, int maxApprovalDays) {
        this.name = name;
        this.maxApprovalDays = maxApprovalDays;
    }
    
    // è®¾ç½®ä¸‹ä¸€ä¸ªå®¡æ‰¹è€…
    public Approver setNext(Approver nextApprover) {
        this.nextApprover = nextApprover;
        return this.nextApprover; // è¿”å›ä¸‹ä¸€ä¸ªï¼Œæ–¹ä¾¿é“¾å¼è°ƒç”¨
    }
    
    // å¤„ç†è¯·å‡è¯·æ±‚
    public ApprovalResult processRequest(LeaveRequest request) {
        System.out.println(name + " æ­£åœ¨å¤„ç†: " + request);
        
        // å¦‚æœå½“å‰å®¡æ‰¹è€…å¯ä»¥å¤„ç†
        if (canApprove(request)) {
            ApprovalResult result = doApprove(request);
            System.out.println(name + " å¤„ç†å®Œæˆ: " + result);
            return result;
        }
        
        // å¦‚æœæœ‰ä¸‹ä¸€ä¸ªå®¡æ‰¹è€…ï¼Œä¼ é€’è¯·æ±‚
        if (nextApprover != null) {
            System.out.println(name + " æ— æ³•å¤„ç†ï¼Œè½¬äº¤ç»™ " + nextApprover.name);
            return nextApprover.processRequest(request);
        }
        
        // æ²¡æœ‰ä¸‹ä¸€ä¸ªå®¡æ‰¹è€…ï¼Œæ‹’ç»è¯·æ±‚
        System.out.println("æ‰€æœ‰å®¡æ‰¹è€…éƒ½æ— æ³•å¤„ç†æ­¤è¯·æ±‚");
        return new ApprovalResult(false, "ç³»ç»Ÿ", "æ— åˆé€‚çš„å®¡æ‰¹äºº");
    }
    
    // åˆ¤æ–­æ˜¯å¦å¯ä»¥å®¡æ‰¹
    protected abstract boolean canApprove(LeaveRequest request);
    
    // æ‰§è¡Œå®¡æ‰¹
    protected abstract ApprovalResult doApprove(LeaveRequest request);
}
```





### 4. å…·ä½“å¤„ç†è€…

```java
package cn.probiecoder.chain;


// å°ç»„é•¿å®¡æ‰¹è€…ï¼ˆå¯å®¡æ‰¹1-3å¤©ï¼‰
public class TeamLeader extends Approver {
    public TeamLeader(String name) {
        super(name, 3);
    }
    
    @Override
    protected boolean canApprove(LeaveRequest request) {
        return request.getLeaveDays() <= maxApprovalDays && 
               !request.getReason().contains("å©šå‡"); // å°ç»„é•¿ä¸èƒ½å®¡æ‰¹å©šå‡
    }
    
    @Override
    protected ApprovalResult doApprove(LeaveRequest request) {
        String comments = "å°ç»„é•¿å®¡æ‰¹é€šè¿‡";
        if (request.getLeaveDays() > 2) {
            comments += "ï¼Œè¯·æ³¨æ„å·¥ä½œäº¤æ¥";
        }
        return new ApprovalResult(true, name, comments);
    }
}
```



```java
package cn.probiecoder.chain;

// HRå®¡æ‰¹è€…ï¼ˆç‰¹æ®Šç±»å‹å‡æœŸï¼‰
public class HRManager extends Approver {
    public HRManager(String name) {
        super(name, Integer.MAX_VALUE);
    }
    
    @Override
    protected boolean canApprove(LeaveRequest request) {
        // HRä¸“é—¨å¤„ç†ç‰¹æ®Šå‡æœŸï¼šå©šå‡ã€äº§å‡ã€ç—…å‡ç­‰
        String reason = request.getReason().toLowerCase();
        return reason.contains("å©šå‡") || 
               reason.contains("äº§å‡") || 
               reason.contains("ç—…å‡");
    }
    
    @Override
    protected ApprovalResult doApprove(LeaveRequest request) {
        String reason = request.getReason().toLowerCase();
        String comments;
        
        if (reason.contains("å©šå‡")) {
            comments = "HRå®¡æ‰¹é€šè¿‡ï¼Œç¥æ–°å©šå¿«ä¹ï¼";
        } else if (reason.contains("äº§å‡")) {
            comments = "HRå®¡æ‰¹é€šè¿‡ï¼Œæ­å–œæ·»ä¸ï¼";
        } else if (reason.contains("ç—…å‡")) {
            comments = "HRå®¡æ‰¹é€šè¿‡ï¼Œè¯·å¥½å¥½ä¼‘å…»";
        } else {
            comments = "HRå®¡æ‰¹é€šè¿‡";
        }
        
        return new ApprovalResult(true, name, comments);
    }
}
```



```java
package cn.probiecoder.chain;

// æ€»ç›‘å®¡æ‰¹è€…ï¼ˆå¯å®¡æ‰¹8-15å¤©ï¼‰
public class Director extends Approver {
    public Director(String name) {
        super(name, 15);
    }
    
    @Override
    protected boolean canApprove(LeaveRequest request) {
        return request.getLeaveDays() <= maxApprovalDays;
    }
    
    @Override
    protected ApprovalResult doApprove(LeaveRequest request) {
        String comments = "æ€»ç›‘å®¡æ‰¹é€šè¿‡";
        if (request.getLeaveDays() > 10) {
            comments += "ï¼Œéœ€æ³¨æ„é¡¹ç›®è¿›åº¦";
        }
        return new ApprovalResult(true, name, comments);
    }
}
```



```java
package cn.probiecoder.chain;


// éƒ¨é—¨ç»ç†å®¡æ‰¹è€…ï¼ˆå¯å®¡æ‰¹4-7å¤©ï¼‰
public class DepartmentManager extends Approver {
    public DepartmentManager(String name) {
        super(name, 7);
    }
    
    @Override
    protected boolean canApprove(LeaveRequest request) {
        return request.getLeaveDays() <= maxApprovalDays;
    }
    
    @Override
    protected ApprovalResult doApprove(LeaveRequest request) {
        String comments = "éƒ¨é—¨ç»ç†å®¡æ‰¹é€šè¿‡";
        if (request.getLeaveDays() > 5) {
            comments += "ï¼Œè¯·å®‰æ’å¥½å·¥ä½œ";
        }
        return new ApprovalResult(true, name, comments);
    }
}
```



```java
package cn.probiecoder.chain;

// CEOå®¡æ‰¹è€…ï¼ˆå¯å®¡æ‰¹16å¤©ä»¥ä¸Šï¼‰
public class CEO extends Approver {
    public CEO(String name) {
        super(name, Integer.MAX_VALUE);
    }
    
    @Override
    protected boolean canApprove(LeaveRequest request) {
        // CEOå¯ä»¥å®¡æ‰¹æ‰€æœ‰è¯·æ±‚ï¼Œä½†éœ€è¦ç‰¹æ®Šç†ç”±
        return !request.getReason().contains("æ— æ•…"); // ä¸èƒ½å®¡æ‰¹æ— æ•…è¯·å‡
    }
    
    @Override
    protected ApprovalResult doApprove(LeaveRequest request) {
        String comments = "CEOå®¡æ‰¹é€šè¿‡";
        if (request.getLeaveDays() > 20) {
            comments += "ï¼Œè¯·æ³¨æ„é•¿æœŸç¦»å²—çš„å½±å“";
        }
        return new ApprovalResult(true, name, comments);
    }
}
```





### 5. å®¢æˆ·ç«¯ä½¿ç”¨

```java
package cn.probiecoder.chain;

import java.time.LocalDate;

// å®¢æˆ·ç«¯ï¼šè¯·å‡ç³»ç»Ÿ
public class LeaveSystem {
    public static void main(String[] args) {
        System.out.println("=== è´£ä»»é“¾æ¨¡å¼ - è¯·å‡å®¡æ‰¹ç³»ç»Ÿ ===\n");
        
        // 1. åˆ›å»ºå®¡æ‰¹é“¾
        System.out.println("1. åˆ›å»ºå®¡æ‰¹é“¾ï¼š");
        Approver teamLeader = new TeamLeader("å¼ ä¸‰ï¼ˆç»„é•¿ï¼‰");
        Approver hrManager = new HRManager("æå››ï¼ˆHRï¼‰");
        Approver deptManager = new DepartmentManager("ç‹äº”ï¼ˆç»ç†ï¼‰");
        Approver director = new Director("èµµå…­ï¼ˆæ€»ç›‘ï¼‰");
        Approver ceo = new CEO("é’±ä¸ƒï¼ˆCEOï¼‰");
        
        // æ„å»ºå®¡æ‰¹é“¾ï¼šç»„é•¿ â†’ HR â†’ ç»ç† â†’ æ€»ç›‘ â†’ CEO
        teamLeader.setNext(hrManager)
                 .setNext(deptManager)
                 .setNext(director)
                 .setNext(ceo);
        
        System.out.println("å®¡æ‰¹é“¾æ„å»ºå®Œæˆ: ç»„é•¿ â†’ HR â†’ ç»ç† â†’ æ€»ç›‘ â†’ CEO\n");
        
        // 2. åˆ›å»ºè¯·å‡è¯·æ±‚
        System.out.println("2. æµ‹è¯•ä¸åŒè¯·å‡è¯·æ±‚:\n");
        
        // è¯·æ±‚1ï¼šçŸ­å‡æœŸï¼ˆåº”ç”±ç»„é•¿å®¡æ‰¹ï¼‰
        System.out.println("è¯·æ±‚1ï¼šçŸ­å‡æœŸï¼ˆ2å¤©ï¼‰");
        LeaveRequest request1 = new LeaveRequest(
            "å‘˜å·¥A", 
            2, 
            "ä¸ªäººäº‹åŠ¡", 
            LocalDate.now().plusDays(1)
        );
        ApprovalResult result1 = teamLeader.processRequest(request1);
        System.out.println("æœ€ç»ˆç»“æœ: " + result1 + "\n");
        
        // è¯·æ±‚2ï¼šä¸­ç­‰å‡æœŸï¼ˆåº”ç”±ç»ç†å®¡æ‰¹ï¼‰
        System.out.println("è¯·æ±‚2ï¼šä¸­ç­‰å‡æœŸï¼ˆ5å¤©ï¼‰");
        LeaveRequest request2 = new LeaveRequest(
            "å‘˜å·¥B", 
            5, 
            "æ—…æ¸¸åº¦å‡", 
            LocalDate.now().plusDays(3)
        );
        ApprovalResult result2 = teamLeader.processRequest(request2);
        System.out.println("æœ€ç»ˆç»“æœ: " + result2 + "\n");
        
        // è¯·æ±‚3ï¼šå©šå‡ï¼ˆåº”ç”±HRå®¡æ‰¹ï¼‰
        System.out.println("è¯·æ±‚3ï¼šå©šå‡ï¼ˆ10å¤©ï¼‰");
        LeaveRequest request3 = new LeaveRequest(
            "å‘˜å·¥C", 
            10, 
            "å©šå‡", 
            LocalDate.now().plusDays(7)
        );
        ApprovalResult result3 = teamLeader.processRequest(request3);
        System.out.println("æœ€ç»ˆç»“æœ: " + result3 + "\n");
        
        // è¯·æ±‚4ï¼šé•¿å‡ï¼ˆåº”ç”±CEOå®¡æ‰¹ï¼‰
        System.out.println("è¯·æ±‚4ï¼šé•¿å‡ï¼ˆ30å¤©ï¼‰");
        LeaveRequest request4 = new LeaveRequest(
            "å‘˜å·¥D", 
            30, 
            "æµ·å¤–è¿›ä¿®", 
            LocalDate.now().plusDays(15)
        );
        ApprovalResult result4 = teamLeader.processRequest(request4);
        System.out.println("æœ€ç»ˆç»“æœ: " + result4 + "\n");
        
        // è¯·æ±‚5ï¼šæ— æ³•å®¡æ‰¹çš„è¯·æ±‚
        System.out.println("è¯·æ±‚5ï¼šæ— æ³•å®¡æ‰¹çš„è¯·æ±‚ï¼ˆæ— æ•…è¯·å‡ï¼‰");
        LeaveRequest request5 = new LeaveRequest(
            "å‘˜å·¥E", 
            3, 
            "æ— æ•…è¯·å‡", 
            LocalDate.now().plusDays(1)
        );
        ApprovalResult result5 = teamLeader.processRequest(request5);
        System.out.println("æœ€ç»ˆç»“æœ: " + result5 + "\n");
        
        // 3. åŠ¨æ€ä¿®æ”¹å®¡æ‰¹é“¾
        System.out.println("3. åŠ¨æ€ä¿®æ”¹å®¡æ‰¹é“¾ï¼š");
        System.out.println("ç»„é•¿ä¸´æ—¶è¯·å‡ï¼Œç»ç†ç›´æ¥å¤„ç†2å¤©å‡æœŸ");
        
        // åˆ›å»ºæ–°çš„å®¡æ‰¹é“¾ï¼šHR â†’ ç»ç† â†’ æ€»ç›‘ â†’ CEOï¼ˆè·³è¿‡äº†ç»„é•¿ï¼‰
        hrManager.setNext(deptManager)
                .setNext(director)
                .setNext(ceo);
        
        LeaveRequest request6 = new LeaveRequest(
            "å‘˜å·¥F", 
            2, 
            "ç´§æ€¥äº‹åŠ¡", 
            LocalDate.now()
        );
        ApprovalResult result6 = hrManager.processRequest(request6);
        System.out.println("æœ€ç»ˆç»“æœ: " + result6 + "\n");
        
        // 4. æŸ¥çœ‹è´£ä»»é“¾æµç¨‹
        System.out.println("4. è´£ä»»é“¾æµç¨‹æ¼”ç¤ºï¼š");
        demonstrateChainFlow(teamLeader);
    }
    
    private static void demonstrateChainFlow(Approver firstApprover) {
        System.out.println("\n=== è´£ä»»é“¾æµç¨‹æ¼”ç¤º ===");
        
        // æ¼”ç¤ºä¸åŒå¤©æ•°çš„å®¡æ‰¹æµç¨‹
        int[] leaveDays = {1, 4, 8, 18, 25};
        String[] reasons = {"äº‹å‡", "ç—…å‡", "åŸ¹è®­", "å©šå‡", "è¿›ä¿®"};
        
        for (int i = 0; i < leaveDays.length; i++) {
            System.out.println("\n--- æµ‹è¯•: " + leaveDays[i] + "å¤©" + reasons[i] + " ---");
            LeaveRequest request = new LeaveRequest(
                "æµ‹è¯•å‘˜å·¥",
                leaveDays[i],
                reasons[i],
                LocalDate.now().plusDays(1)
            );
            
            firstApprover.processRequest(request);
        }
    }
}
```

