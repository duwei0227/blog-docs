---
title: è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°å™¨æ¨¡å¼
published: false
layout: post
date: 2025-12-09 11:40:00
permalink: /design_pattern/decorator_pattern.html
categories: [è®¾è®¡æ¨¡å¼]

---



## æ¦‚å¿µ

**è£…é¥°å™¨æ¨¡å¼**æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å‘ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆä¸æ”¹å˜å…¶ç»“æ„ã€‚è£…é¥°å™¨æ¨¡å¼æ˜¯ç»§æ‰¿çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šåŒ…è£…ä¸€ä¸ªå¯¹è±¡ï¼Œæä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå¹¶ä¿æŒæ¥å£çš„ä¸€è‡´æ€§ã€‚



## é€‚ç”¨åœºæ™¯

**âœ… é€‚ç”¨åœºæ™¯ï¼š**

1. **åŠ¨æ€æ·»åŠ åŠŸèƒ½**ï¼šåœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ åŠŸèƒ½
2. **æ›¿ä»£å¤šé‡ç»§æ‰¿**ï¼šé¿å…ä½¿ç”¨å­ç±»ç»§æ‰¿å¯¼è‡´çš„ç±»çˆ†ç‚¸é—®é¢˜
3. **æ’¤é”€åŠŸèƒ½**ï¼šå¯ä»¥æ–¹ä¾¿åœ°ç§»é™¤è£…é¥°
4. **æ ¸å¿ƒåŠŸèƒ½ä¸å˜**ï¼šæ ¸å¿ƒåŠŸèƒ½ä¸å˜ï¼Œåªæ˜¯å¢åŠ é™„åŠ åŠŸèƒ½



**ğŸ¯ å…¸å‹ä¾‹å­ï¼š**

- **Java I/Oæµ**ï¼š`BufferedReader`ã€`DataInputStream`ç­‰
- **GUIç»„ä»¶**ï¼šæ·»åŠ æ»šåŠ¨æ¡ã€è¾¹æ¡†ç­‰è£…é¥°
- **Webè¯·æ±‚å¤„ç†**ï¼šæ·»åŠ æ—¥å¿—ã€è®¤è¯ã€ç¼“å­˜ç­‰åŠŸèƒ½
- **æ•°æ®å‹ç¼©/åŠ å¯†**ï¼šå¯¹æµè¿›è¡Œè£…é¥°å¤„ç†



## ç±»å›¾

![image-20251209115100673](https://raw.githubusercontent.com/duwei0227/picbed/main/blogs/image-20251209115100673.png)

**ç±»å›¾è¯´æ˜ï¼š**

- **`Client`**ï¼šä½¿ç”¨ç»„ä»¶æ¥å£æ“ä½œå¯¹è±¡
- **`Component`**ï¼šç»„ä»¶æ¥å£ï¼Œå®šä¹‰æ ¸å¿ƒåŠŸèƒ½
- **`ConcreteComponent`**ï¼šå…·ä½“ç»„ä»¶ï¼Œå®ç°æ ¸å¿ƒåŠŸèƒ½
- **`Decorator`**ï¼šè£…é¥°å™¨æŠ½è±¡ç±»ï¼ŒæŒæœ‰ç»„ä»¶å¼•ç”¨
- **`ConcreteDecorator`**ï¼šå…·ä½“è£…é¥°å™¨ï¼Œæ·»åŠ æ–°åŠŸèƒ½



**è£…é¥°å™¨æ¨¡å¼ vs ç»§æ‰¿ï¼š**

| ç‰¹æ€§         | è£…é¥°å™¨æ¨¡å¼       | ç»§æ‰¿           |
| :----------- | :--------------- | :------------- |
| **æ‰©å±•æ–¹å¼** | è¿è¡Œæ—¶åŠ¨æ€æ‰©å±•   | ç¼–è¯‘æ—¶é™æ€æ‰©å±• |
| **çµæ´»æ€§**   | é«˜ï¼ˆå¯ä»»æ„ç»„åˆï¼‰ | ä½ï¼ˆå›ºå®šå±‚æ¬¡ï¼‰ |
| **ç±»æ•°é‡**   | å°‘ï¼ˆæŒ‰åŠŸèƒ½åˆ†ï¼‰   | å¤šï¼ˆæŒ‰ç»„åˆåˆ†ï¼‰ |
| **å¯¹è±¡å…³ç³»** | ç»„åˆå…³ç³»         | ç»§æ‰¿å…³ç³»       |
| **ä¿®æ”¹å½±å“** | ä¸å½±å“åŸæœ‰ä»£ç    | å¯èƒ½å½±å“å­ç±»   |



**è£…é¥°å™¨æ¨¡å¼ vs ä»£ç†æ¨¡å¼ï¼š**

| ç‰¹æ€§         | è£…é¥°å™¨æ¨¡å¼ | ä»£ç†æ¨¡å¼   |
| :----------- | :--------- | :--------- |
| **ç›®çš„**     | å¢å¼ºåŠŸèƒ½   | æ§åˆ¶è®¿é—®   |
| **å…³æ³¨ç‚¹**   | åŠŸèƒ½æ‰©å±•   | è®¿é—®æ§åˆ¶   |
| **é€æ˜åº¦**   | é€æ˜è£…é¥°   | å¯èƒ½ä¸é€æ˜ |
| **å¯¹è±¡åˆ›å»º** | å®¢æˆ·ç«¯åˆ›å»º | ä»£ç†åˆ›å»º   |
| **å…¸å‹ä¾‹å­** | Java I/Oæµ | Spring AOP |





## ç¤ºä¾‹(Webè¯·æ±‚å¤„ç†è£…é¥°å™¨)

### 1. HTTPå¤„ç†å™¨æ¥å£

```java
package cn.probiecoder.decorator;

import java.util.HashMap;
import java.util.Map;

// HTTPè¯·æ±‚å¤„ç†å™¨æ¥å£
public interface HttpHandler {
    HttpResponse handle(HttpRequest request);
}

// HTTPè¯·æ±‚ç±»
class HttpRequest {
    private String method;
    private String path;
    private Map<String, String> headers;
    private String body;
    
    public HttpRequest(String method, String path) {
        this.method = method;
        this.path = path;
        this.headers = new HashMap<>();
    }
    
    // getters and setters
    public String getMethod() { return method; }
    public String getPath() { return path; }
    public Map<String, String> getHeaders() { return headers; }
    public String getBody() { return body; }
    public void setBody(String body) { this.body = body; }
    public void addHeader(String key, String value) { headers.put(key, value); }
}

// HTTPå“åº”ç±»
class HttpResponse {
    private int statusCode;
    private Map<String, String> headers;
    private String body;
    
    public HttpResponse(int statusCode) {
        this.statusCode = statusCode;
        this.headers = new HashMap<>();
    }
    
    // getters and setters
    public int getStatusCode() { return statusCode; }
    public Map<String, String> getHeaders() { return headers; }
    public String getBody() { return body; }
    public void setBody(String body) { this.body = body; }
    public void addHeader(String key, String value) { headers.put(key, value); }
}
```





### 2. åŸºç¡€å¤„ç†å™¨(éœ€è¦è¢«è£…é¥°çš„å¯¹è±¡)

```java
package cn.probiecoder.decorator;

// åŸºç¡€HTTPå¤„ç†å™¨
public class BasicHttpHandler implements HttpHandler {
    @Override
    public HttpResponse handle(HttpRequest request) {
        System.out.println("å¤„ç†è¯·æ±‚: " + request.getMethod() + " " + request.getPath());
        
        HttpResponse response = new HttpResponse(200);
        response.setBody("è¯·æ±‚å¤„ç†æˆåŠŸ");
        
        return response;
    }
}
```





### 3. è£…é¥°å™¨æŠ½è±¡ç±»

å®ç°å’Œè¢«è£…é¥°ç±»ç›¸åŒçš„æ¥å£ï¼Œå¹¶ç»„åˆè¢«è£…é¥°å¯¹è±¡

```java
package cn.probiecoder.decorator;

// HTTPå¤„ç†å™¨è£…é¥°å™¨
public abstract class HttpHandlerDecorator implements HttpHandler {
    protected HttpHandler wrappee;
    
    public HttpHandlerDecorator(HttpHandler handler) {
        this.wrappee = handler;
    }
}
```



### 4. å…·ä½“è£…é¥°å™¨

#### 4.1 è®¤è¯

```java
package cn.probiecoder.decorator;

// è®¤è¯è£…é¥°å™¨
public class AuthenticationDecorator extends HttpHandlerDecorator {
    public AuthenticationDecorator(HttpHandler handler) {
        super(handler);
    }
    
    @Override
    public HttpResponse handle(HttpRequest request) {
        String token = request.getHeaders().get("Authorization");
        
        if (token == null || !token.startsWith("Bearer ")) {
            System.out.println("[è®¤è¯] è®¤è¯å¤±è´¥");
            HttpResponse response = new HttpResponse(401);
            response.setBody("æœªæˆæƒ");
            return response;
        }
        
        System.out.println("[è®¤è¯] è®¤è¯é€šè¿‡");
        return wrappee.handle(request);
    }
}
```





#### 4.2 æ—¥å¿—

```java
package cn.probiecoder.decorator;

// æ—¥å¿—è£…é¥°å™¨
public class LoggingDecorator extends HttpHandlerDecorator {
    public LoggingDecorator(HttpHandler handler) {
        super(handler);
    }
    
    @Override
    public HttpResponse handle(HttpRequest request) {
        System.out.println("[æ—¥å¿—] æ”¶åˆ°è¯·æ±‚: " + request.getMethod() + 
                         " " + request.getPath() + 
                         " Body: " + (request.getBody() != null ? request.getBody().substring(0, Math.min(50, request.getBody().length())) : "null"));
        
        long startTime = System.currentTimeMillis();
        HttpResponse response = wrappee.handle(request);
        long endTime = System.currentTimeMillis();
        
        System.out.println("[æ—¥å¿—] å“åº”çŠ¶æ€: " + response.getStatusCode() + 
                         " è€—æ—¶: " + (endTime - startTime) + "ms");
        
        return response;
    }
}
```





#### 4.3 å‹ç¼©

```java
package cn.probiecoder.decorator;

// å‹ç¼©è£…é¥°å™¨
public class CompressionDecorator extends HttpHandlerDecorator {
    public CompressionDecorator(HttpHandler handler) {
        super(handler);
    }
    
    @Override
    public HttpResponse handle(HttpRequest request) {
        HttpResponse response = wrappee.handle(request);
        
        // å¦‚æœå®¢æˆ·ç«¯æ”¯æŒå‹ç¼©ï¼Œåˆ™å‹ç¼©å“åº”ä½“
        String acceptEncoding = request.getHeaders().get("Accept-Encoding");
        if (acceptEncoding != null && acceptEncoding.contains("gzip")) {
            System.out.println("[å‹ç¼©] å‹ç¼©å“åº”ä½“");
            response.addHeader("Content-Encoding", "gzip");
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œä¼šæœ‰å‹ç¼©é€»è¾‘
        }
        
        return response;
    }
}
```



#### 4.4 ç¼“å­˜

```java
package cn.probiecoder.decorator;

import java.util.HashMap;
import java.util.Map;

// ç¼“å­˜è£…é¥°å™¨
public class CachingDecorator extends HttpHandlerDecorator {
    private Map<String, HttpResponse> cache = new HashMap<>();
    
    public CachingDecorator(HttpHandler handler) {
        super(handler);
    }
    
    @Override
    public HttpResponse handle(HttpRequest request) {
        // åªç¼“å­˜GETè¯·æ±‚
        if (!"GET".equalsIgnoreCase(request.getMethod())) {
            return wrappee.handle(request);
        }
        
        String cacheKey = request.getMethod() + ":" + request.getPath();
        
        if (cache.containsKey(cacheKey)) {
            System.out.println("[ç¼“å­˜] ç¼“å­˜å‘½ä¸­");
            return cache.get(cacheKey);
        }
        
        System.out.println("[ç¼“å­˜] ç¼“å­˜æœªå‘½ä¸­");
        HttpResponse response = wrappee.handle(request);
        
        // åªç¼“å­˜æˆåŠŸå“åº”
        if (response.getStatusCode() == 200) {
            cache.put(cacheKey, response);
            System.out.println("[ç¼“å­˜] å·²ç¼“å­˜å“åº”");
        }
        
        return response;
    }
}
```





###  5. å®¢æˆ·ç«¯è°ƒç”¨

```java
package cn.probiecoder.decorator;

// WebæœåŠ¡å™¨æ¨¡æ‹Ÿ
public class WebServer {
    public static void main(String[] args) {
        System.out.println("=== WebæœåŠ¡å™¨è¯·æ±‚å¤„ç†ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰ ===\n");
        
        // 1. åŸºç¡€å¤„ç†å™¨
        System.out.println("1. åŸºç¡€è¯·æ±‚å¤„ç†ï¼š");
        HttpHandler basicHandler = new BasicHttpHandler();
        testHandler(basicHandler, "åŸºç¡€å¤„ç†å™¨");
        
        // 2. æ·»åŠ è®¤è¯
        System.out.println("\n2. æ·»åŠ è®¤è¯åŠŸèƒ½ï¼š");
        HttpHandler authHandler = new AuthenticationDecorator(basicHandler);
        testHandler(authHandler, "è®¤è¯å¤„ç†å™¨");
        
        // 3. æ·»åŠ æ—¥å¿—
        System.out.println("\n3. æ·»åŠ æ—¥å¿—åŠŸèƒ½ï¼š");
        HttpHandler loggingHandler = new LoggingDecorator(basicHandler);
        testHandler(loggingHandler, "æ—¥å¿—å¤„ç†å™¨");
        
        // 4. å¤šå±‚è£…é¥°ï¼šè®¤è¯ + æ—¥å¿— + ç¼“å­˜ + å‹ç¼©
        System.out.println("\n4. å®Œæ•´åŠŸèƒ½æ ˆï¼š");
        HttpHandler fullHandler = new CompressionDecorator(
            new CachingDecorator(
                new LoggingDecorator(
                    new AuthenticationDecorator(
                        new BasicHttpHandler()
                    )
                )
            )
        );
        
        testFullHandler(fullHandler);
        
        // 5. åŠ¨æ€é…ç½®å¤„ç†å™¨é“¾
        System.out.println("\n5. åŠ¨æ€é…ç½®å¤„ç†å™¨é“¾ï¼š");
        configureHandlerDynamically();
    }
    
    private static void testHandler(HttpHandler handler, String name) {
        System.out.println("æµ‹è¯•ï¼š" + name);
        
        HttpRequest request = new HttpRequest("GET", "/api/users");
        request.addHeader("Authorization", "Bearer valid_token");
        
        HttpResponse response = handler.handle(request);
        System.out.println("å“åº”çŠ¶æ€ç ï¼š" + response.getStatusCode());
        System.out.println("å“åº”ä½“ï¼š" + response.getBody());
    }
    
    private static void testFullHandler(HttpHandler handler) {
        System.out.println("æµ‹è¯•å®Œæ•´åŠŸèƒ½å¤„ç†å™¨ï¼š");
        
        // ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ˆåº”è¯¥ç»è¿‡æ‰€æœ‰å¤„ç†ï¼‰
        System.out.println("\nç¬¬ä¸€æ¬¡è¯·æ±‚ï¼ˆæ— ç¼“å­˜ï¼‰ï¼š");
        HttpRequest request1 = new HttpRequest("GET", "/api/products");
        request1.addHeader("Authorization", "Bearer valid_token");
        request1.addHeader("Accept-Encoding", "gzip");
        
        HttpResponse response1 = handler.handle(request1);
        System.out.println("å“åº”ï¼š" + response1.getStatusCode());
        
        // ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆåº”è¯¥ä»ç¼“å­˜è¯»å–ï¼‰
        System.out.println("\nç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆåº”è¯¥æœ‰ç¼“å­˜ï¼‰ï¼š");
        HttpRequest request2 = new HttpRequest("GET", "/api/products");
        request2.addHeader("Authorization", "Bearer valid_token");
        request2.addHeader("Accept-Encoding", "gzip");
        
        HttpResponse response2 = handler.handle(request2);
        System.out.println("å“åº”ï¼š" + response2.getStatusCode());
        
        // POSTè¯·æ±‚ï¼ˆä¸åº”è¯¥ç¼“å­˜ï¼‰
        System.out.println("\nPOSTè¯·æ±‚ï¼ˆä¸åº”è¯¥ç¼“å­˜ï¼‰ï¼š");
        HttpRequest request3 = new HttpRequest("POST", "/api/products");
        request3.addHeader("Authorization", "Bearer valid_token");
        request3.setBody("{\"name\":\"æ–°äº§å“\"}");
        
        HttpResponse response3 = handler.handle(request3);
        System.out.println("å“åº”ï¼š" + response3.getStatusCode());
    }
    
    private static void configureHandlerDynamically() {
        // åŸºç¡€å¤„ç†å™¨
        HttpHandler handler = new BasicHttpHandler();
        
        // æ ¹æ®ç¯å¢ƒé…ç½®æ·»åŠ è£…é¥°å™¨
        String environment = "production"; // å¯ä»¥ä»é…ç½®è¯»å–
        boolean enableAuth = true;
        boolean enableLogging = true;
        boolean enableCaching = true;
        boolean enableCompression = true;
        
        System.out.println("ç¯å¢ƒï¼š" + environment);
        System.out.println("é…ç½®ï¼šè®¤è¯=" + enableAuth + 
                         ", æ—¥å¿—=" + enableLogging + 
                         ", ç¼“å­˜=" + enableCaching + 
                         ", å‹ç¼©=" + enableCompression);
        
        // æŒ‰ç‰¹å®šé¡ºåºæ·»åŠ è£…é¥°å™¨
        if (enableAuth) {
            handler = new AuthenticationDecorator(handler);
            System.out.println("æ·»åŠ è®¤è¯è£…é¥°å™¨");
        }
        
        if (enableLogging) {
            handler = new LoggingDecorator(handler);
            System.out.println("æ·»åŠ æ—¥å¿—è£…é¥°å™¨");
        }
        
        if (enableCaching) {
            handler = new CachingDecorator(handler);
            System.out.println("æ·»åŠ ç¼“å­˜è£…é¥°å™¨");
        }
        
        if (enableCompression) {
            handler = new CompressionDecorator(handler);
            System.out.println("æ·»åŠ å‹ç¼©è£…é¥°å™¨");
        }
        
        System.out.println("\næœ€ç»ˆå¤„ç†å™¨é“¾é…ç½®å®Œæˆ");
        System.out.println("å¤„ç†å™¨é“¾é•¿åº¦ï¼š" + countDecorators(handler) + " å±‚è£…é¥°");
        
        // æµ‹è¯•é…ç½®çš„å¤„ç†å™¨
        HttpRequest request = new HttpRequest("GET", "/api/test");
        request.addHeader("Authorization", "Bearer valid_token");
        
        HttpResponse response = handler.handle(request);
        System.out.println("æµ‹è¯•å“åº”ï¼š" + response.getStatusCode());
    }
    
    private static int countDecorators(HttpHandler handler) {
        int count = 0;
        while (handler instanceof HttpHandlerDecorator) {
            count++;
            handler = ((HttpHandlerDecorator) handler).wrappee;
        }
        return count;
    }
}
```



